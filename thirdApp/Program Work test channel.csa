using System.Numerics;
using Kernel.AFCP;

internal class Program
{
    private static void Main(string[] args)
    {
        Console.WriteLine("Start!");

        var ConnectedKernels = new List<KernelDescriptor>();

        var channelManager = new ChannelManager() { ConnectedKernels = ConnectedKernels };

        //var moduleManager = new ModuleManager(channelManager);

        channelManager.Join("127.0.0.1", 8000);
        Console.WriteLine("Connected!");
        //var lidarDataChannel = channelManager.GetDataChannel("/slamPos");
        var interfPos = channelManager.GetInterfaceForChannel<Vector3>("/slamPos");
        var interfMap = channelManager.GetInterfaceForChannel<byte[]>("/SLAMmap");

        var interfLidar = channelManager.GetInterfaceForChannel<byte[]>("/lidarData");
        interfPos?.AddEvent((aa) =>
        {
            Console.WriteLine("Pos data rec!!" + aa);
        });
        interfMap?.AddEvent((aa) =>
        {
            Console.WriteLine("Map data rec!!");
        });
       
        interfLidar?.AddEvent((aa) =>
       {
           Console.WriteLine("Lidar data rec!!");
       });

        Console.WriteLine("Get: " + interfPos?.Get());

        Thread.Sleep(50000);

        channelManager.Stop();

    }
}